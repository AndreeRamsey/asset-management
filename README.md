# Asset Management

A repository for Asset Management for OOI data.

## Workflow

The current system requires a very specific workflow due to the way in which asset data is integrated into the system. Here are a few key points:

NOTE:  As per Tickets #9466 #9468, when files of the form 
    ._* 	or 
    ._*.csv   or
    .DS_
are included in requests to update this repository, these "hidden" files are to be ignored. 


### Bulk Load - Asset Records

* When loading asset records (*-AssetRecord.csv)
  * Whole sheet ingest. Loading the bulk load sheet requires dropping all the assets from the system and reloading. Otherwise, duplicate asset records will be made.
  * Modifications. It is possible to add additions assets (not in the original sheet) by creating new -AssetRecord sheets. This can be done without dropping the asset database, but will require restarting the UI.
  * These data must be loaded before any dependent data (integration events or deployment events) can be loaded.

### Integration Events

* Integration Events (*-IntegrationEvents.csv)
  * For RSN data, these are autogenerated from the source deployment sheets (must be done in google sheets due to formula limitations).

### Deployment/Calibration Events

* Deployment Events (Omaha_Cal_Info-*.xlsx)
  * These are the last sheets that should be uploaded.
  * For RSN, there is a single sheet that is loaded for all deployments and calibration. 
    * This was done at the request of the MIO so they can track the changes between deployments.
    * Also note that redeployment is on a per instrument basis for RSN, not per mooring like on the uncabled assets.

## Updating Asset Management

In general, asset management updates are applied in one of two ways:

### Clean Refresh

Clean refresh requires stopping the production server. This can have undesirable effects (no access to data, backlog of streaming data). However, this is the only way to make updates without duplicating asset records. 

1. Stop EDEX - edex stop
1. Reset Database - resetdb
1. Stop UI
1. Reset UI Database
1. Start EDEX
1. Ingest bulk load - cp bulk_load/*csv .../asset_spreadsheets/.
1. Ingest Integration Events - cp integration/* .../asset_spreadsheets/.
1. Ingest Deployment Events - deployment/* .../asset_spreadsheets/.

### Manual Update

Manual updates through the UI will be lost unless they are committed to the spreadsheets manually:
1. User applies update in the UI.
1. User applies update to corresponding ingest sheet.
1. User submits change to gerrit.
1. SCM approves and merges the change. (Ready for the next clean refresh)
